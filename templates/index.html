<head>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>
</head>

<script type=text/javascript>
  var timeout = 2000; // ms
  var ch1 = [];
  var ch2 = [];

  // Makes AJAX request to Flask server
  function executeQuery() { 
      $.get($SCRIPT_ROOT + '/_model_output', function(data) {
        $("#model_output").text(data.result);
      });
      $.get($SCRIPT_ROOT + '/_model_data', function(data) {
        $("#model_data").text(data.result);
        ch1 = data.result[0];
        ch2 = data.result[1];
      });
  }

  function plotData() {
    console.log(ch1.length);
    Highcharts.chart('container', {

      title: {
          text: 'Live Voltage Readings'
      },

      yAxis: {
          title: {
              text: 'Voltage'
          }
      },

      legend: {
          layout: 'vertical',
          align: 'right',
          verticalAlign: 'middle'
      },

      plotOptions: {
          series: {
              label: {
                  connectorAllowed: false
              }
          }
      },

      series: [{
          name: 'Channel 1',
          data: ch1
      }, {
          name: 'Channel 2',
          data: ch2
      }],

      responsive: {
          rules: [{
              condition: {
                  maxWidth: 500
              },
              chartOptions: {
                  legend: {
                      layout: 'horizontal',
                      align: 'center',
                      verticalAlign: 'bottom'
                  }
              }
          }]
      }

    });
  }

  $(function() {
    setInterval(executeQuery, timeout);
    setInterval(plotData, timeout);
  });
</script>

<body>
  <h1>Flask Server for Reading ML Data</h1>
  Model output: <span id="model_output"></span><br>
  Model data: <span id="model_data"></span>

  <figure class="highcharts-figure">
    <div id="container"></div>
    <p class="highcharts-description">
        Basic line chart showing trends in a dataset. This chart includes the
        <code>series-label</code> module, which adds a label to each line for
        enhanced readability.
    </p>
</figure>
</body>